---
import '../styles/global.css';
import Section from '../components/Section.astro';
import Container from '../components/Container.astro';
import FlexGrid from '../components/FlexGrid.astro';
import Card from '../components/Card.astro';

const year = new Date().getFullYear();
---
<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>DocLogic — автоматизация ввода данных и документооборота</title>
    <meta name="description" content="
    DocLogic автоматически переносит все данные из фото/PDF товарных накладных в готовые данные
    для передачи в CRM / складской и бух. учёт / 1C и любые другие программы без ручного ввода данных." />
    <link rel="icon" href="/assets/favicon.svg" />
  </head>
  <body>
    <!-- Top Nav -->
    <header class="sticky top-0 z-50 border-b border-slate-200/70 bg-white/70 backdrop-blur">
      <div class="container flex h-16 items-center justify-between">
        <a href="#top" class="flex items-center gap-3">
          <span class="inline-flex h-9 w-9 items-center justify-center rounded-xl bg-slate-900 text-white font-bold">DL</span>
          <span class="font-semibold">DocLogic</span>
        </a>

        <nav class="hidden md:flex items-center gap-6 text-sm text-slate-600">
          <a class="hover:text-slate-900" href="#how">Как работает</a>
          <a class="hover:text-slate-900" href="#benefits">Выгоды</a>
          <a class="hover:text-slate-900" href="#integrations">Интеграции</a>
          <a class="hover:text-slate-900" href="#examples">Примеры</a>
          <a class="hover:text-slate-900" href="#custom">Настройка</a>
          <a class="hover:text-slate-900" href="#pricing">Внедрение и цена</a>
          <a class="hover:text-slate-900" href="#faq">FAQ</a>
        </nav>

        <a class="btn btn-primary" href="#request">Запросить предложение</a>
      </div>
    </header>

    <main id="top">
      <!-- Hero -->
      <Section>
        <Container>
          <FlexGrid cols={2} gap="lg" items="start" class="lg:grid-cols-2">
            <div>
              <div class="badge badge-lg">AI для складского документооборота</div>
              <h2 class="mt-4 text-3xl md:text-4xl font-bold tracking-tight">
                <!--Перестаньте платить за<br />ввод данных -->

                Ввод данных вручную <br>- это деньги и ошибки
              </h2>
              <p class="p mt-4 max-w-xl text-lg text-slate-700">
                DocLogic автоматически переносит все данные из фото/PDF документов на компьютер для передачи в <b>CRM / ERP /складской и бух. учёт / 1C и любые другие программы</b>.
              </p>

              <ul class="mt-6 space-y-3 text-lg text-slate-700">
                <li class="flex gap-3"><span class="mt-1 inline-flex h-5 w-5 items-center justify-center rounded-full bg-slate-900 text-white text-base">✓</span> Экономия бюджета на вводе данных</li>
                <li class="flex gap-3"><span class="mt-1 inline-flex h-5 w-5 items-center justify-center rounded-full bg-slate-900 text-white text-base">✓</span> Быстрее закрытие поступлений и актуальные данные</li>
                <li class="flex gap-3"><span class="mt-1 inline-flex h-5 w-5 items-center justify-center rounded-full bg-slate-900 text-white text-base">✓</span> Отсутствие ручных ошибок</li>
              </ul>

              <div class="mt-8 flex flex-wrap gap-3">
                <a class="btn btn-primary" href="#request">Запросить предложение</a>
                <a class="btn btn-secondary" href="#how">Как работает</a>
              </div>

            </div>

            <Card>
              <div class="flex items-start justify-between gap-4">
                <div>
                  <div class="flex items-center gap-2">
                    <h3 class="text-lg font-semibold">Из печатной накладной → в компьютерные данные</h3>
                  </div>
                  <div class="mt-1 text-sm text-slate-600">
                    Фото/pdf документа → AI‑анализ → CRM / ERP/ складской и бух. учёт / 1C / Excel / Google Sheets и любые другие программы
                  </div>
                </div>
              </div>

              <div class="mt-4 rounded-2xl bg-slate-50 ring-1 ring-slate-200 overflow-hidden">
                <img src="/assets/best_image_for_site2.png" alt="Из накладной в данные" class="w-full" loading="lazy" />
              </div>
            </Card>
          </FlexGrid>
        </Container>
      </Section>

      <!-- How it works (4 steps) -->
      <Section id="how">
        <Container>
          <h2 class="h2">Как DocLogic работает</h2>
          <p class="p mt-2"><b>Вход — накладная (фото/скан/PDF), выход — готовые данные в вашу систему.</b></p>

          <FlexGrid cols={4} gap="md" class="mt-8">
            <Card variant="feature">
              <div class="badge">Шаг 1</div>
              <div class="mt-3 text-lg font-semibold">Загружаете накладную</div>
              <div class="p mt-2 text-sm">через Telegram или на сайте</div>
            </Card>
            <Card variant="feature">
              <div class="badge">Шаг 2</div>
              <div class="mt-3 text-lg font-semibold">AI извлекает строки и реквизиты</div>
              <div class="p mt-2 text-sm">Извлекаем <b>абсолютно все данные</b> из документа.</div>
            </Card>
            <Card variant="feature">
              <div class="badge">Шаг 3</div>
              <div class="mt-3 text-lg font-semibold">Вы подтверждаете исключения</div>
              <div class="p mt-2 text-sm">Программа передает абсолютно все данные. Человек контролирует исключения — рутина уходит.</div>
            </Card>
            <Card variant="feature">
              <div class="badge">Шаг 4</div>
              <div class="mt-3 text-lg font-semibold">Данные уходят в Вашу систему</div>
              <div class="p mt-2 text-sm">В зависимости от ваших требований, необходимые данные будут
              отправляться в любое место: CRM / ERP/ складской и бух. учёт / 1C и любые другие программы. </div>
            </Card>
          </FlexGrid>
        </Container>
      </Section>

      <!-- Benefits -->
      <Section id="benefits">
        <Container>
          <h2 class="h2">Выгоды для бизнеса</h2>
          <p class="p mt-2"><b>Основной эффект — сокращение затрат на ручной ввод данных и исключение ошибок.</b></p>

          <FlexGrid cols={4} gap="md" class="mt-8">
            <Card variant="feature">
              <div class="text-base font-semibold">Экономия бюджета и времени</div>
              <p class="p mt-2 text-sm">Рутинный ввод уходит: меньше операторов — или те же люди делают более ценную работу.</p>
            </Card>
            <Card variant="feature">
              <div class="text-base font-semibold">Отсутствие ошибок</div>
              <p class="p mt-2 text-sm">Программа создана настолько качественно, что все данные вносит правильно. Человеческий фактор всегда допускает ошибки.</p>
            </Card>
            <Card variant="feature">
              <div class="text-base font-semibold">Быстрое закрытие поступлений</div>
              <p class="p mt-2 text-sm">Данные быстрее попадают в систему — склад и бухгалтерия работают синхронно.</p>
            </Card>
            <Card variant="feature">
              <div class="text-base font-semibold">Специальная детальная настройка</div>
              <p class="p mt-2 text-sm">Программа будет настроена согласно всем вашим требованиям</p>
            </Card>
          </FlexGrid>
        </Container>
      </Section>


      <!-- Examples of documents -->
      <Section id="examples">
        <Container>
          <h2 class="h2">Примеры документов</h2>


          <FlexGrid cols={4} gap="md" class="mt-8">
            <Card class="overflow-hidden p-0">
              <img src="/assets/invoice.jpg" alt="Пример накладной" class="h-44 w-full object-cover" loading="lazy" />
              <div class="p-3 text-xm text-slate-600">Классическая накладная</div>
            </Card>
            <Card class="overflow-hidden p-0">
              <img src="/assets/french_invoice.jpg" alt="Пример накладной на иностранном языке" class="h-44 w-full object-cover" loading="lazy" />
              <div class="p-3 text-xm text-slate-600">Другой язык и формат</div>
            </Card>
            <Card class="overflow-hidden p-0">
              <img src="/assets/rostov.jpeg" alt="Пример товарной накладной" class="h-44 w-full object-cover" loading="lazy" />
              <div class="p-3 text-xm text-slate-600">Много позиций и плохое качество</div>
            </Card>
            <Card class="overflow-hidden p-0">
              <img src="/assets/camozzi.jpg" alt="Пример документа поставщика" class="h-44 w-full object-cover" loading="lazy" />
              <div class="p-3 text-xm text-slate-600">Нестандартный шаблон</div>
            </Card>
          </FlexGrid>
        </Container>
      </Section>


      <!-- Integrations -->
      <Section id="integrations">
        <Container>
          <h2 class="h2">Интеграции</h2>
          <p class="p mt-2"><b>Передаём данные туда, где вы работаете — без "ручных мостиков".</b></p>

          <FlexGrid cols={1} gap="md" class="mt-8">
            <Card>
              <div class="text-base font-semibold">Куда выгружаем</div>
              <div class="mt-4 grid gap-3 sm:grid-cols-2 text-sm">
                <div class="flex items-start gap-3"><span class="mt-0.5 inline-flex h-6 w-6 items-center justify-center rounded-full bg-slate-100">✓</span><div><b>CRM / ERP</b></div></div>
                <div class="flex items-start gap-3"><span class="mt-0.5 inline-flex h-6 w-6 items-center justify-center rounded-full bg-slate-100">✓</span><div><b>Бухгалтерские/учётные системы  / 1C</b></div></div>
                <div class="flex items-start gap-3"><span class="mt-0.5 inline-flex h-6 w-6 items-center justify-center rounded-full bg-slate-100">✓</span><div><b>Excel / Google Sheets</b></div></div>
                <div class="flex items-start gap-3"><span class="mt-0.5 inline-flex h-6 w-6 items-center justify-center rounded-full bg-slate-100">✓</span><div><b>Любая другая программа</b></div></div>
              </div>

            </Card>
          </FlexGrid>
        </Container>
      </Section>

      <!-- Customization / key advantage -->
      <Section id="custom">
        <Container>
          <h2 class="h2">Настройка под ваши требования</h2>
          <p class="p mt-2"><b>Накладные бывают любыми: разные языки, таблицы, форматы. DocLogic приводит их к той структуре данных, которая вам нужна</b>.</p>

          <FlexGrid cols={1} gap="md" class="mt-8">
            <Card>
              <div class="text-base font-semibold">Главное преимущество</div>
              <p class="p mt-2 text-sm">
                <b><b>DocLogic настраивается под ваш документооборот</b>: <br>
                какие поля извлекать,
                нормализация номенклатуры,
                необходимость переводов,
                правила округления/НДС/единицы измерения и в каком виде отправлять результат.
              </p>

              <div class="mt-4 grid gap-3 sm:grid-cols-2 text-sm">
                <div class="rounded-2xl bg-slate-50 ring-1 ring-slate-200 p-4"><b>Поля и таблицы</b><div class="mt-1 text-slate-600">Позиции, количества, цены, суммы, реквизиты, и т.д.</div></div>
                <div class="rounded-2xl bg-slate-50 ring-1 ring-slate-200 p-4"><b>Правила обработки</b><div class="mt-1 text-slate-600">Сопоставления, нормализация, проверки.</div></div>
                <div class="rounded-2xl bg-slate-50 ring-1 ring-slate-200 p-4"><b>Структура на выходе</b><div class="mt-1 text-slate-600">Любая, согласно вашим требованиям.</div></div>
                <div class="rounded-2xl bg-slate-50 ring-1 ring-slate-200 p-4"><b>Интеграции</b><div class="mt-1 text-slate-600">API, файлы, web‑форма подтверждения.</div></div>
              </div>

              <p class="p mt-3 text-sm"><b>На выходе вы получаете данные в формате вашей системы</b> — и процесс становится стабильным даже при «зоопарке» накладных.</p>

            </Card>
          </FlexGrid>
        </Container>
      </Section>

      <!-- FAQ -->
      <Section id="faq">
        <Container>
          <h2 class="h2">FAQ</h2>
          <p class="p mt-2"><b>Короткие ответы на типовые вопросы.</b></p>

          <div class="mt-8 space-y-3">
            <details class="rounded-2xl bg-white ring-1 ring-slate-200 p-5">
              <summary class="flex cursor-pointer items-center justify-between font-semibold text-slate-900">
                <span class="flex-1">Это заменяет сотрудников?</span>
                <span class="ml-4 text-slate-400 transition-transform">▶</span>
              </summary>
              <div class="mt-3 pt-3 border-t border-slate-100">
                <p class="p text-sm">Нет — снимает рутину. Человек контролирует исключения и сложные случаи.</p>
              </div>
            </details>

            <details class="rounded-2xl bg-white ring-1 ring-slate-200 p-5">
              <summary class="flex cursor-pointer items-center justify-between font-semibold text-slate-900">
                <span class="flex-1">Если у поставщиков разные шаблоны?</span>
                <span class="ml-4 text-slate-400 transition-transform">▶</span>
              </summary>
              <div class="mt-3 pt-3 border-t border-slate-100">
                <p class="p text-sm">Это нормально. DocLogic работает с любыми типами документов.</p>
              </div>
            </details>

            <details class="rounded-2xl bg-white ring-1 ring-slate-200 p-5">
              <summary class="flex cursor-pointer items-center justify-between font-semibold text-slate-900">
                <span class="flex-1">Можно без Telegram?</span>
                <span class="ml-4 text-slate-400 transition-transform">▶</span>
              </summary>
              <div class="mt-3 pt-3 border-t border-slate-100">
                <p class="p text-sm">Да, есть загрузка через сайт и интеграции по API.</p>
              </div>
            </details>

            <details class="rounded-2xl bg-white ring-1 ring-slate-200 p-5">
              <summary class="flex cursor-pointer items-center justify-between font-semibold text-slate-900">
                <span class="flex-1">Насколько быстро внедрение?</span>
                <span class="ml-4 text-slate-400 transition-transform">▶</span>
              </summary>
              <div class="mt-3 pt-3 border-t border-slate-100">
                <p class="p text-sm">Все зависит от только сложности внедрения программы в Вашу систему. </p>
              </div>
            </details>
          </div>
        </Container>
      </Section>

      <!-- Pricing moved later (after value) -->
      <Section id="pricing">
        <Container>
          <h2 class="h2">Внедрение и цена</h2>
          <p class="p mt-2">Стоимость зависит от сложности внедрения и поддержки программы, объёма и типов документов с.</p>

          <FlexGrid cols={3} gap="md" class="mt-8">
            <Card>
              <div class="text-sm font-semibold text-slate-600">Настройка</div>
              <div class="mt-2 text-3xl font-bold">от 400 €</div>
              <p class="p mt-2 text-sm">Исходя из стоимости внедрения и доработки программы под ваши требования</p>
            </Card>
            <Card>
              <div class="text-sm font-semibold text-slate-600">Подписка</div>
              <div class="mt-2 text-3xl font-bold">от 100 €/мес</div>
              <p class="p mt-2 text-sm">Зависит от сложности тех. поддержки, объёма и сценариев обработки.</p>
            </Card>
            <Card>
              <div class="text-sm font-semibold text-slate-600">Что входит</div>
              <ul class="mt-3 space-y-2 text-sm text-slate-700">
                <li class="flex gap-2"><span class="mt-1">•</span> настройка под ваши шаблоны</li>
                <li class="flex gap-2"><span class="mt-1">•</span> интеграция (API/файлы/форма)</li>
                <li class="flex gap-2"><span class="mt-1">•</span> поддержка и развитие</li>
              </ul>
            </Card>
          </FlexGrid>

          <div class="mt-6 small">Примечание: детали фиксируем в коммерческом предложении после просмотра ваших примеров документов.</div>
        </Container>
      </Section>

      <!-- Request -->
      <Section id="request">
        <Container>
          <Card variant="dark" padding="lg">
            <FlexGrid cols={2} gap="lg" items="start">
              <div>
                <div class="badge bg-white/10 text-white">Запрос</div>
                <h2 class="mt-4 text-3xl md:text-4xl font-bold tracking-tight">Запросить предложение</h2>
                <p class="mt-3 text-white/80 leading-relaxed">
                  Пришлите примеры накладных — мы оценим объём, подскажем сценарий внедрения и подготовим коммерческое предложение.
                </p>
                <ul class="mt-6 space-y-3 text-sm text-white/85">
                  <li class="flex gap-3"><span class="mt-1 inline-flex h-5 w-5 items-center justify-center rounded-full bg-white/15">✓</span> обработка ваших реальных документов</li>
                  <li class="flex gap-3"><span class="mt-1 inline-flex h-5 w-5 items-center justify-center rounded-full bg-white/15">✓</span> пример структуры данных «как вам нужно»</li>
                  <li class="flex gap-3"><span class="mt-1 inline-flex h-5 w-5 items-center justify-center rounded-full bg-white/15">✓</span> план внедрения и оценка экономии</li>
                </ul>
              </div>

              <form id="leadForm" class="rounded-3xl bg-white text-slate-900 p-6 md:p-7" enctype="multipart/form-data">
                <!-- Honeypot field for spam protection (hidden from users) -->
                <input type="text" name="website" autocomplete="off" tabindex="-1" style="position:absolute;left:-9999px;" aria-hidden="true" />

                <div class="text-lg font-semibold">Контакты</div>
                <p class="mt-1 text-sm text-slate-600">Оставьте имя и любой контакт (email или телефон). Можно приложить примеры документов.</p>

                <div class="mt-5 grid gap-4 sm:grid-cols-2">
                  <div>
                    <label class="text-sm font-medium" for="name">Имя</label>
                    <input id="name" name="name" required class="mt-2 w-full rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm" placeholder="" />
                  </div>
                  <div>
                    <label class="text-sm font-medium" for="company">Компания</label>
                    <input id="company" name="company" class="mt-2 w-full rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm" placeholder="" />
                  </div>
                  <div>
                    <label class="text-sm font-medium" for="email">Email</label>
                    <input id="email" name="email" type="email" class="mt-2 w-full rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm" placeholder="name@company.com" />
                  </div>
                  <div>
                    <label class="text-sm font-medium" for="phone">Телефон</label>
                    <input id="phone" name="phone" class="mt-2 w-full rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm" placeholder="" />
                  </div>
                </div>

{false && (
                <div class="mt-4">
                  <div class="text-sm font-medium">Типы документов</div>
                  <div class="mt-3 grid gap-3 sm:grid-cols-2">
                    <label class="check"><input type="checkbox" name="doc_types" value="Накладные" checked />Накладные</label>
                    <label class="check"><input type="checkbox" name="doc_types" value="Счета" />Счета</label>
                    <label class="check"><input type="checkbox" name="doc_types" value="Акты" />Акты</label>
                    <label class="check"><input type="checkbox" name="doc_types" value="Другое" />Другое</label>
                  </div>
                </div>
              )}

                <div class="mt-4">
                  <label class="text-sm font-medium" for="samples">Примеры документов (опционально)</label>
                  <input id="samples" name="samples" type="file" class="file mt-2" multiple accept="image/*,application/pdf" />
                  <div class="small mt-2">Можно приложить до 5 файлов (фото/сканы/PDF).</div>
                </div>

                <div class="mt-4">
                  <label class="text-sm font-medium" for="message">Комментарий</label>
                  <textarea id="message" name="message" rows="4" class="mt-2 w-full rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm" placeholder="Какая система учёта/CRM, сколько накладных в месяц, какие поставщики…"></textarea>
                </div>

                <button id="submitBtn" class="btn btn-primary w-full mt-6" type="submit">Отправить запрос</button>
                <div id="formMsg" class="small mt-3"></div>

                <!--
                  DEMO (не показываем на сайте сейчас):
                  - после получения запроса предлагать выбрать слот на демо через 5–7 дней
                  - можно подключить Calendly/Cal.com
                -->
              </form>
            </FlexGrid>
          </Card>
        </Container>
      </Section>

      <footer class="py-8">
        <div class="container flex flex-col gap-3 md:flex-row md:items-center md:justify-between text-sm text-slate-500">
          <div>© {year} DocLogic</div>
          <a class="hover:text-slate-800" href="https://scan.doclogic.eu/" target="_blank">Тестовая версия</a>
        </div>
      </footer>
    </main>

    <script>
      const form = document.getElementById('leadForm');
      const msg = document.getElementById('formMsg');
      const submitBtn = document.getElementById('submitBtn');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        msg.textContent = '';

        const email = (document.getElementById('email').value || '').trim();
        const phone = (document.getElementById('phone').value || '').trim();
        if (!email && !phone) {
          msg.textContent = 'Укажите email или телефон — любой контакт подходит.';
          msg.className = 'small mt-3 text-red-600';
          return;
        }

        // Disable button and show loading state
        submitBtn.disabled = true;
        const originalText = submitBtn.textContent;
        submitBtn.textContent = 'Отправка...';
        submitBtn.style.opacity = '0.7';
        submitBtn.style.cursor = 'not-allowed';

        const fd = new FormData(form);

        // Collect doc_types into one array field
        const selected = [...form.querySelectorAll('input[name="doc_types"]:checked')].map(i => i.value);
        fd.delete('doc_types');
        selected.forEach(v => fd.append('doc_types', v));

        try {
          const res = await fetch('/api/lead', { method: 'POST', body: fd });
          if (!res.ok) throw new Error(await res.text());

          const data = await res.json();
          console.log('Результаты отправки:', data.results);

          // Check critical channels (email and telegram)
          // WhatsApp is optional, so we ignore its errors
          const criticalChannels = ['email', 'telegram'];
          const criticalResults = criticalChannels
            .map(key => data.results?.[key])
            .filter(Boolean);

          // Check if critical channels have errors
          const criticalHasErrors = criticalResults.some(r => r.error);
          // Check if at least one critical channel succeeded
          const criticalHasSuccess = criticalResults.some(r => r.ok);

          // Check if critical channels were skipped (not configured)
          const criticalAllSkipped = criticalResults.length > 0 &&
            criticalResults.every(r => r.skipped && !r.ok);

          if (criticalHasErrors) {
            console.error('Ошибки при отправке в критичные каналы:', data.results);
            msg.textContent = 'Запрос отправлен, но возникли ошибки при уведомлении. Проверьте логи сервера.';
            msg.className = 'small mt-3 text-yellow-600';
            // Re-enable button on error
            submitBtn.disabled = false;
            submitBtn.textContent = originalText;
            submitBtn.style.opacity = '1';
            submitBtn.style.cursor = 'pointer';
          } else if (criticalAllSkipped) {
            console.warn('Критичные уведомления не настроены:', data.results);
            msg.textContent = 'Запрос отправлен. Уведомления не настроены.';
            msg.className = 'small mt-3 text-yellow-600';
            // Re-enable button on warning
            submitBtn.disabled = false;
            submitBtn.textContent = originalText;
            submitBtn.style.opacity = '1';
            submitBtn.style.cursor = 'pointer';
          } else if (criticalHasSuccess) {
            // At least one critical channel succeeded - redirect to thanks page
            window.location.href = '/thanks/';
            return;
          } else {
            // Fallback: if we got here, something unexpected happened
            console.warn('Неожиданное состояние результатов:', data.results);
            // Still redirect to thanks page as form was submitted
            window.location.href = '/thanks';
            return;
          }
        } catch (err) {
          msg.textContent = 'Не удалось отправить. Проверьте соединение и попробуйте ещё раз.';
          msg.className = 'small mt-3 text-red-600';
          console.error('Ошибка отправки:', err);
          // Re-enable button on error
          submitBtn.disabled = false;
          submitBtn.textContent = originalText;
          submitBtn.style.opacity = '1';
          submitBtn.style.cursor = 'pointer';
        }
      });
    </script>
  </body>
</html>
