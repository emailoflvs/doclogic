# üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞ —á–µ—Ä–µ–∑ Git

## ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞

`git pull` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ **–ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç production —Ñ–∞–π–ª—ã**, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏:
- `docker-compose.yml` - —Ä–∞–∑–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ—Ä—Ç—ã, —Å–µ—Ç–∏, Traefik)
- `api/.env` - —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏, —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –ó–∞—â–∏—Ç–∞ —Ñ–∞–π–ª–æ–≤ –≤ Git

**–§–∞–π–ª—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `.gitignore`:**
- `docker-compose.yml` - –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è –≤ git
- `docker-compose.yml.example` - —à–∞–±–ª–æ–Ω –¥–ª—è –Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤

**–ü—Ä–∞–≤–∏–ª–æ:** Production —Ñ–∞–π–ª—ã **–ù–ï –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ git!**

### 2. –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç `safe_update_server.sh`

```bash
./safe_update_server.sh
```

–°–∫—Ä–∏–ø—Ç:
1. –°–æ–∑–¥–∞—ë—Ç –±—ç–∫–∞–ø—ã production —Ñ–∞–π–ª–æ–≤
2. –û–±–Ω–æ–≤–ª—è–µ—Ç –∫–æ–¥ –∏–∑ git
3. –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç production —Ñ–∞–π–ª—ã –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
4. –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

#### –í–∞—Ä–∏–∞–Ω—Ç B: –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

```bash
# 1. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å production —Ñ–∞–π–ª—ã
ssh debian@57.129.62.58
cd /opt/docker-projects/doclogic_gpt
cp docker-compose.yml docker-compose.yml.production_backup
cp api/.env api/.env.production_backup

# 2. –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã (–Ω–µ —Ç—Ä–æ–≥–∞—è production)
# –ï—Å–ª–∏ –µ—Å—Ç—å git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
git fetch origin
git checkout origin/master -- api/emails/ web/src/ # —Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª—ã –∫–æ–¥–∞

# –ò–ª–∏ —á–µ—Ä–µ–∑ rsync (—Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª—ã –∫–æ–¥–∞):
rsync -avz --exclude='docker-compose.yml' --exclude='api/.env' \
  ./ debian@57.129.62.58:/opt/docker-projects/doclogic_gpt/

# 3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å production —Ñ–∞–π–ª—ã
mv docker-compose.yml.production_backup docker-compose.yml
mv api/.env.production_backup api/.env

# 4. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
docker compose build
docker compose up -d
```

#### –í–∞—Ä–∏–∞–Ω—Ç C: –û–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ñ–∞–π–ª—ã

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ, –µ—Å–ª–∏ –µ—Å—Ç—å git:
cd /opt/docker-projects/doclogic_gpt
git fetch origin

# –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ñ–∞–π–ª, –Ω–∞–ø—Ä–∏–º–µ—Ä:
git checkout origin/master -- web/src/pages/index.astro

# –ù–ï —Ç—Ä–æ–≥–∞—Ç—å:
# - docker-compose.yml (–æ—Å—Ç–∞–≤–∏—Ç—å production –≤–µ—Ä—Å–∏—é)
# - api/.env (–æ—Å—Ç–∞–≤–∏—Ç—å production –≤–µ—Ä—Å–∏—é)
```

### 3. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
/opt/docker-projects/doclogic_gpt/
‚îú‚îÄ‚îÄ docker-compose.yml          # ‚ùå –ù–ï –≤ git, production –≤–µ—Ä—Å–∏—è
‚îú‚îÄ‚îÄ docker-compose.yml.example  # ‚úÖ –í git, —à–∞–±–ª–æ–Ω
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ .env                    # ‚ùå –ù–ï –≤ git, —Å–µ–∫—Ä–µ—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ .env.example            # ‚úÖ –í git, —à–∞–±–ª–æ–Ω
‚îî‚îÄ‚îÄ ... (–æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –∫–æ–¥–∞)
```

### 4. –ß—Ç–æ –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å

‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å:**
- –§–∞–π–ª—ã –∫–æ–¥–∞: `api/src/`, `web/src/`, `emails/`
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∫–æ–¥–∞: `package.json`, `Dockerfile`, `nginx.conf`
- –®–∞–±–ª–æ–Ω—ã: `docker-compose.yml.example`, `api/.env.example`

‚ùå **–ù–ï –æ–±–Ω–æ–≤–ª—è—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
- `docker-compose.yml` - –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è production –≤–µ—Ä—Å–∏–µ–π
- `api/.env` - –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è production –≤–µ—Ä—Å–∏–µ–π

### 5. –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º

- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –≤ git
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ production —Ñ–∞–π–ª—ã –∑–∞—â–∏—â–µ–Ω—ã
- [ ] –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø—ã –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª—ã –∫–æ–¥–∞
- [ ] –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å production —Ñ–∞–π–ª—ã –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- [ ] –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å–∞–π—Ç–∞

### 6. –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫

```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –±—ç–∫–∞–ø–∞:
ssh debian@57.129.62.58
cd /opt/docker-projects/doclogic_gpt
cp docker-compose.yml.backup.YYYYMMDD_HHMMSS docker-compose.yml
cp api/.env.backup.YYYYMMDD_HHMMSS api/.env
docker compose up -d
```

## üìù –ò—Ç–æ–≥

**–ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ:** 
> Production —Ñ–∞–π–ª—ã (`docker-compose.yml`, `.env`) **–ù–ï –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ git** –∏ **–ù–ï –¥–æ–ª–∂–Ω—ã –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è** –ø—Ä–∏ `git pull`.

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç `safe_update_server.sh` –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ —Ç–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ñ–∞–π–ª—ã –∫–æ–¥–∞ –≤—Ä—É—á–Ω—É—é.

